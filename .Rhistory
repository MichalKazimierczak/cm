while (length(remote_driver$findElements(using="xpath",
"//div[@class='btn btn-default']"))>0){
button_element <- remote_driver$findElement(using="xpath",
"//div[@class='btn btn-default']")
button_element$clickElement()
Sys.sleep(8)}
}
tit <- remote_driver$findElements(using="xpath"
,"//h3//span[@class='t-item']")
doc_links <- data.frame()
ep_docs <- data.frame()
for (k in :nrow(keys))
for (k in 1:nrow(keys))
{
remote_driver$navigate(
paste0('https://www.europarl.europa.eu/RegistreWeb/search/simpleSearchHome.htm?startDate=',start_unix,
'&endDate=',end_unix,'&fulltext="',keys[k,"keyword"],'"')
)
Sys.sleep(10)
res <- remote_driver$findElement(using="xpath",
"//span[@id='total-results-number']")
res <- res$getElementText()
res <- as.integer(res)
if(res==0) next
p <- floor(res/10)
p <- ifelse(res%%10 == 0, p-1,p)
p<-ifelse(res<10,0,p)
if (p>0){
while (length(remote_driver$findElements(using="xpath",
"//div[@class='btn btn-default']"))>0){
button_element <- remote_driver$findElement(using="xpath",
"//div[@class='btn btn-default']")
button_element$clickElement()
Sys.sleep(8)}
}
tit <- remote_driver$findElements(using="xpath"
,"//h3//span[@class='t-item']")
Sys.sleep(5)
#tit<-remote_driver$findElements(using="xpath","//div[@class='erpl_search-results-item']")
doc <- sapply(tit, function(x){x$getElementText()})
doc <- unlist(doc)
doc_date <- remote_driver$findElements(using="xpath",
"//span[@class='erpl_search-results-item-subtitle-date']")
doc_date <- sapply(doc_date, function(x){x$getElementText()})
doc_date <- unlist(doc_date)
doc_id_t<-remote_driver$findElements(using="xpath",
"//span[@class='erpl_search-results-item-subtitle-category text-primary font-weight-bold']")
doc_id<-sapply(doc_id_t,function(x){x$getElementText()})
doc_id <- unlist(doc_id)
docs <- data.frame(doc_id = doc_id,
doc_title= doc,
doc_date = doc_date)
docs$keyword <- keys[k,1]
docs$doc_id <- str_replace(docs$doc_id, "\\/.*","")
docs$doc_id <- str_replace_all(docs$doc_id, "\\s+","")
ep_docs <- rbind(ep_docs,docs)
i<-2
for (i in 1:length(tit))
{
Sys.sleep(2)
doc_id_t[[i]]$clickElement()
Sys.sleep(2)
print(i)
}
#remote_driver$refresh()
links <- doc_id_t[[i]]$findChildElements(using="xpath",
"//a[@class='t-item']")
links <- sapply(links, function(x){x$getElementAttribute("href")})
links <- unlist(links)
links <- str_extract(links,".*EN.pdf|.*EN.docx|.*EN.doc")
